"use strict";(self["webpackChunkhexschool_vue_week6_work"]=self["webpackChunkhexschool_vue_week6_work"]||[]).push([[996],{996:function(e,t,l){l.r(t),l.d(t,{default:function(){return fe}});var a=l(6252),r=l(3577);const o={class:"list m-3 p-3"},s=(0,a._)("h5",null,"訂單管理",-1),d={class:"my-3 text-end"},n={class:"table-responsive-sm"},i={class:"table table-hover"},c=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{width:"100"},"成立時間"),(0,a._)("th",{width:"200"},"訂購人"),(0,a._)("th",{width:"150"},"產品總數"),(0,a._)("th",{width:"100"},"訂單總計"),(0,a._)("th",{width:"150"},"訂單備註"),(0,a._)("th",{width:"100"},"付款狀態"),(0,a._)("th",{width:"100"},"編輯")])],-1),u={class:"text-start"},p=(0,a._)("button",{type:"button",class:"btn-main dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"false"}," 查看訂單明細 ",-1),_={class:"dropdown-menu"},m={class:"dropdown-item"},b=(0,a.Uk)(" (無) "),g={key:0},h={key:1,class:"text-danger"},w={class:"btn-group"},y=["onClick"],f=["onClick"];function v(e,t,l,v,k,O){const x=(0,a.up)("Loading"),D=(0,a.up)("AdminOrderModal"),z=(0,a.up)("Pagination");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",o,[s,(0,a.Wm)(x,{active:k.isLoading,loader:"dots"},null,8,["active"]),(0,a._)("div",d,[(0,a._)("button",{class:"btn btn-danger px-3 py-2",onClick:t[0]||(t[0]=e=>O.deleteOrder("所有"))}," 刪除所有訂單 ")]),(0,a._)("div",n,[(0,a._)("table",i,[c,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(k.orderData,(e=>((0,a.wg)(),(0,a.iD)("tr",{class:"align-middle",key:e.id},[(0,a._)("td",null,(0,r.zw)(e.local_create_at),1),(0,a._)("td",u,[(0,a._)("p",null,"姓名："+(0,r.zw)(e.user.name),1),(0,a._)("p",null,"Email："+(0,r.zw)(e.user.email),1),(0,a._)("p",null,"電話："+(0,r.zw)(e.user.tel),1),(0,a._)("p",null,"地址："+(0,r.zw)(e.user.address),1)]),(0,a._)("td",null,[(0,a._)("p",null,(0,r.zw)(e.totalQty),1),p,(0,a._)("ul",_,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.products,(e=>((0,a.wg)(),(0,a.iD)("li",{key:e.id},[(0,a._)("span",m,(0,r.zw)(e.product.title)+" "+(0,r.zw)(e.qty)+" "+(0,r.zw)(e.product.unit),1)])))),128))])]),(0,a._)("td",null,(0,r.zw)(e.total),1),(0,a._)("td",null,[e.message?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)((0,r.zw)(e.message),1)],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[b],64))]),(0,a._)("td",null,[e.is_paid?((0,a.wg)(),(0,a.iD)("span",g,"已付款")):((0,a.wg)(),(0,a.iD)("span",h,"未付款"))]),(0,a._)("td",null,[(0,a._)("div",w,[(0,a._)("button",{type:"button",class:"btn btn-outline-main btn-sm me-3",onClick:t=>O.openModal(e)}," 更新 ",8,y),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>O.deleteOrder(e.user.name,e.id)}," 刪除 ",8,f)])])])))),128))])])])]),(0,a.Wm)(D,{ref:"OrderModal","init-order":k.tempOrder,onAfterUpdate:O.getOrders},null,8,["init-order","onAfterUpdate"]),(0,a.Wm)(z,{class:"d-flex justify-content-center",pages:k.pagination,onEmitPage:O.getOrders},null,8,["pages","onEmitPage"])])}var k=l(4711),O=l(6718),x=l(9963);const D={id:"orderModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},z={class:"modal-dialog modal-xl"},C={class:"modal-content border-0"},M={class:"modal-header bg-dark text-white"},U={id:"productModalLabel",class:"modal-title"},P=(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),V={class:"modal-body"},L={class:"row mb-3"},Z=(0,a._)("div",{class:"col-3"},"訂單成立",-1),$={class:"col-9 text-start"},q={class:"row mb-3"},A=(0,a._)("div",{class:"col-3"},"付款狀況",-1),E={class:"col-9 text-start"},H={key:0,for:"checkbox"},Y={key:1,class:"text-danger",for:"checkbox"},Q={class:"row mb-3"},j=(0,a._)("h5",null,"訂購人",-1),K={class:"col-6"},N={class:"form-group mb-3"},W=(0,a._)("label",{for:"username",class:"form-label"},"姓名",-1),B={class:"form-group mb-3"},T=(0,a._)("label",{for:"email",class:"form-label"},"Email",-1),F={class:"col-6"},S={class:"form-group mb-3"},G=(0,a._)("label",{for:"tel",class:"form-label"},"電話",-1),I={class:"form-group mb-3"},J=(0,a._)("label",{for:"address",class:"form-label"},"住址",-1),R={class:"row mb-3"},X=(0,a._)("h5",null,"訂單明細",-1),ee={class:"table"},te=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{scope:"col"},"產品名稱"),(0,a._)("th",{scope:"col"},"產品內容"),(0,a._)("th",{scope:"col"},"數量"),(0,a._)("th",{scope:"col"},"單價"),(0,a._)("th",{scope:"col"},"小計")])],-1),le=["onUpdate:modelValue","onBlur"],ae=["onUpdate:modelValue"],re=(0,a._)("td",null,null,-1),oe=(0,a._)("td",null,"總計",-1),se=(0,a._)("td",null,null,-1),de={class:"row m-3"},ne=(0,a._)("label",{for:"message",class:"form-label"},"訂單留言",-1),ie={class:"modal-footer"},ce=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ue=["disabled"];function pe(e,t,l,o,s,d){return(0,a.wg)(),(0,a.iD)("div",D,[(0,a._)("div",z,[(0,a._)("div",C,[(0,a._)("div",M,[(0,a._)("h5",U," 更新 "+(0,r.zw)(s.order.id)+" 訂單 ",1),P]),(0,a._)("div",V,[(0,a._)("div",L,[Z,(0,a._)("div",$,(0,r.zw)(s.order.local_create_at),1)]),(0,a._)("div",q,[A,(0,a._)("div",E,[(0,a.wy)((0,a._)("input",{type:"checkbox",id:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>s.order.is_paid=e)},null,512),[[x.e8,s.order.is_paid]]),s.order.is_paid?((0,a.wg)(),(0,a.iD)("label",H,"已付款")):((0,a.wg)(),(0,a.iD)("label",Y,"未付款"))])]),(0,a._)("div",Q,[j,(0,a._)("div",K,[(0,a._)("div",N,[W,(0,a.wy)((0,a._)("input",{id:"username","onUpdate:modelValue":t[1]||(t[1]=e=>s.order.user.name=e),type:"text",class:"form-control"},null,512),[[x.nr,s.order.user.name]])]),(0,a._)("div",B,[T,(0,a.wy)((0,a._)("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=e=>s.order.user.email=e),type:"email",class:"form-control"},null,512),[[x.nr,s.order.user.email]])])]),(0,a._)("div",F,[(0,a._)("div",S,[G,(0,a.wy)((0,a._)("input",{id:"tel","onUpdate:modelValue":t[3]||(t[3]=e=>s.order.user.tel=e),type:"text",class:"form-control"},null,512),[[x.nr,s.order.user.tel]])]),(0,a._)("div",I,[J,(0,a.wy)((0,a._)("input",{id:"address","onUpdate:modelValue":t[4]||(t[4]=e=>s.order.user.address=e),type:"text",class:"form-control"},null,512),[[x.nr,s.order.user.address]])])])]),(0,a._)("div",R,[X,(0,a._)("table",ee,[te,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(s.order.products,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,r.zw)(e.product.title),1),(0,a._)("td",null,(0,r.zw)(e.product.content),1),(0,a._)("td",null,[(0,a.wy)((0,a._)("input",{id:"qty","onUpdate:modelValue":t=>e.qty=t,type:"text",class:"form-control col-3",onBlur:t=>d.updateTotal(e)},null,40,le),[[x.nr,e.qty]])]),(0,a._)("td",null,(0,r.zw)(e.product.price),1),(0,a._)("td",null,[(0,a.wy)((0,a._)("input",{id:"qty","onUpdate:modelValue":t=>e.final_total=t,type:"text",class:"form-control col-3"},null,8,ae),[[x.nr,e.final_total]])])])))),128)),(0,a._)("tr",null,[re,oe,(0,a._)("td",null,(0,r.zw)(s.order.totalQty),1),se,(0,a._)("td",null,(0,r.zw)(s.order.total),1)])])])]),(0,a._)("div",de,[ne,(0,a.wy)((0,a._)("textarea",{class:"form-control",id:"message",rows:"3","onUpdate:modelValue":t[5]||(t[5]=e=>s.order.message=e)},"\n            ",512),[[x.nr,s.order.message]])])]),(0,a._)("div",ie,[ce,(0,a._)("button",{type:"button",class:"btn btn-outline-main",onClick:t[6]||(t[6]=(...e)=>d.updateOrder&&d.updateOrder(...e)),disabled:s.isProcessing}," 更新 ",8,ue)])])])],512)}var _e=l(2863),me={name:"OrderModal",props:["init-order"],data(){return{modal:"",order:{products:{},user:{}},isProcessing:!1}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},updateTotal(e){e.final_total=e.qty*e.product.price;let t=0;Object.values(this.order.products).map((e=>t+=e.final_total)),this.order.total=t},async updateOrder(){try{this.isProcessing=!0;const e=await k.Z.orders.putOrder({id:this.order.id,data:this.order});_e.FN.fire({icon:"success",title:e.message}),this.isProcessing=!1,this.hideModal(),this.$emit("after-update")}catch(e){}}},mounted(){const e=l(7244);this.modal=new e.Modal(this.$refs.modal,{keyboard:!1,backdrop:"static"})},watch:{initOrder(){this.order=this.initOrder}}},be=l(3744);const ge=(0,be.Z)(me,[["render",pe]]);var he=ge,we={name:"AdminOrderList",components:{Pagination:O.Z,AdminOrderModal:he},data(){return{orderData:[],pagination:{},isLoading:!1,tempOrder:{}}},methods:{async getOrders(e=1){try{this.isLoading=!0;const{orders:t,pagination:l}=await k.Z.orders.getOrders(e),a=Object.values(t);a.forEach((e=>{e.totalQty=this.calcQty(e.products),e.local_create_at=new Date(1e3*e.create_at).toLocaleString()})),this.orderData=t,this.pagination=l,this.isLoading=!1}catch(t){}},calcQty(e){let t=0;return Object.values(e).forEach((e=>t+=Number(e.qty))),t},async deleteOrder(e,t){const l=await _e._1.fire({title:`確定刪除${e}的訂單 ？`});if(l.isConfirmed){let l="";l="所有"===e?await k.Z.orders.deleteOrderAll():await k.Z.orders.deleteOrder(t),await this.$swal.fire({icon:"success",title:l.message}),this.getOrders()}},openModal(e){this.tempOrder={...e},this.$refs.OrderModal.openModal()}},created(){this.getOrders()}};const ye=(0,be.Z)(we,[["render",v]]);var fe=ye},6718:function(e,t,l){l.d(t,{Z:function(){return g}});var a=l(6252),r=l(3577);const o={"aria-label":"Page navigation example"},s={class:"pagination"},d=(0,a._)("span",{"aria-hidden":"true"},"«",-1),n=[d],i=["onClick"],c=(0,a._)("span",{"aria-hidden":"true"},"»",-1),u=[c];function p(e,t,l,d,c,p){return(0,a.wg)(),(0,a.iD)("nav",o,[(0,a._)("ul",s,[(0,a._)("li",{class:(0,r.C_)(["page-item",{disabled:!l.pages.has_pre}])},[(0,a._)("button",{type:"button",class:"page-link",href:"#","aria-label":"Previous",onClick:t[0]||(t[0]=t=>e.$emit("emit-page",l.pages.current_page-1))},n)],2),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(l.pages.total_pages,((t,o)=>((0,a.wg)(),(0,a.iD)("li",{class:(0,r.C_)(["page-item",{active:t===l.pages.current_page}]),href:"#",key:o},[(0,a._)("button",{type:"button",class:"page-link",onClick:l=>e.$emit("emit-page",t)},(0,r.zw)(t),9,i)],2)))),128)),(0,a._)("li",{class:(0,r.C_)(["page-item",{disabled:!l.pages.has_next}])},[(0,a._)("button",{type:"button",class:"page-link","aria-label":"Next",onClick:t[1]||(t[1]=t=>e.$emit("emit-page",l.pages.current_page+1))},u)],2)])])}var _={props:["pages"]},m=l(3744);const b=(0,m.Z)(_,[["render",p]]);var g=b}}]);
//# sourceMappingURL=996.cfed95f9.js.map