"use strict";(self["webpackChunkhexschool_vue_week6_work"]=self["webpackChunkhexschool_vue_week6_work"]||[]).push([[800],{7800:function(o,e,t){t.r(e),t.d(e,{default:function(){return J}});var a=t(6252),n=t(3577);const s={class:"list m-3 p-3"},l=(0,a._)("h5",null,"優惠券管理",-1),i={class:"my-3 text-end"},d={class:"table-responsive-sm"},c={class:"table table-hover"},u=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{width:"150"},"優惠券名稱"),(0,a._)("th",{width:"150"},"優惠碼"),(0,a._)("th",{width:"150"},"可使用數量"),(0,a._)("th",{width:"150"},"折扣"),(0,a._)("th",{width:"200"},"到期日"),(0,a._)("th",{width:"200"},"編輯")])],-1),p={class:"btn-group"},r=["onClick"],_=["onClick"];function m(o,e,t,m,b,h){const g=(0,a.up)("Loading"),w=(0,a.up)("CouponModal"),f=(0,a.up)("Pagination");return(0,a.wg)(),(0,a.iD)("div",s,[l,(0,a.Wm)(g,{active:b.isLoading,loader:"dots"},null,8,["active"]),(0,a._)("div",i,[(0,a._)("button",{class:"btn btn-main px-3 py-2",onClick:e[0]||(e[0]=o=>h.openModal("new"))}," 新增優惠券 ")]),(0,a._)("div",d,[(0,a._)("table",c,[u,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(b.coupons,(o=>((0,a.wg)(),(0,a.iD)("tr",{class:"align-middle",key:o.id},[(0,a._)("td",null,(0,n.zw)(o.title),1),(0,a._)("td",null,(0,n.zw)(o.code),1),(0,a._)("td",null,(0,n.zw)(o.is_enabled),1),(0,a._)("td",null,(0,n.zw)(o.percent),1),(0,a._)("td",null,(0,n.zw)(o.local_due_date),1),(0,a._)("td",null,[(0,a._)("div",p,[(0,a._)("button",{type:"button",class:"btn btn-outline-main btn-sm me-3",onClick:e=>h.openModal("edit",o)}," 編輯 ",8,r),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>h.deleteCoupon(o.title,o.id)}," 刪除 ",8,_)])])])))),128))])])]),(0,a.Wm)(w,{ref:"couponModal",onAfterUpdate:h.getCoupons,"init-coupon":b.coupon,"is-new":b.isNew},null,8,["onAfterUpdate","init-coupon","is-new"]),(0,a.Wm)(f,{class:"d-flex justify-content-center",pages:b.pagination,onEmitPage:h.getCoupons},null,8,["pages","onEmitPage"])])}var b=t(4711),h=t(6718),g=t(9963);const w={class:"modal fade",ref:"modal",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},f={class:"modal-dialog"},v={class:"modal-content"},C=(0,a._)("div",{class:"modal-header"},[(0,a._)("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),y={class:"modal-body"},k={class:"mb-3 row"},x=(0,a._)("label",{for:"title",class:"col-sm-4 col-form-label"},"優惠券名稱",-1),M={class:"col-sm-8"},D={class:"mb-3 row"},P=(0,a._)("label",{for:"code",class:"col-sm-4 col-form-label"},"優惠碼",-1),L={class:"col-sm-8"},Z={class:"mb-3 row"},$=(0,a._)("label",{for:"is_enabled",class:"col-sm-4 col-form-label"},"可使用數量",-1),N={class:"col-sm-8"},U={class:"mb-3 row"},z=(0,a._)("label",{for:"percent",class:"col-sm-4 col-form-label"},"折扣",-1),V={class:"col-sm-8"},A={class:"mb-3 row"},E=(0,a._)("label",{for:"due_date",class:"col-sm-4 col-form-label"},"到期日",-1),W={class:"col-sm-8"},j={class:"modal-footer"},H=(0,a._)("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1),K=["disabled"],Y=["disabled"];function F(o,e,t,n,s,l){return(0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("div",f,[(0,a._)("div",v,[C,(0,a._)("div",y,[(0,a._)("div",k,[x,(0,a._)("div",M,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=o=>s.coupon.title=o)},null,512),[[g.nr,s.coupon.title]])])]),(0,a._)("div",D,[P,(0,a._)("div",L,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":e[1]||(e[1]=o=>s.coupon.code=o)},null,512),[[g.nr,s.coupon.code]])])]),(0,a._)("div",Z,[$,(0,a._)("div",N,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"is_enabled","onUpdate:modelValue":e[2]||(e[2]=o=>s.coupon.is_enabled=o)},null,512),[[g.nr,s.coupon.is_enabled,void 0,{number:!0}]])])]),(0,a._)("div",U,[z,(0,a._)("div",V,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"percent","onUpdate:modelValue":e[3]||(e[3]=o=>s.coupon.percent=o)},null,512),[[g.nr,s.coupon.percent,void 0,{number:!0}]])])]),(0,a._)("div",A,[E,(0,a._)("div",W,[(0,a.wy)((0,a._)("input",{type:"datetime-local",class:"form-control",id:"due_date","onUpdate:modelValue":e[4]||(e[4]=o=>s.coupon.local_due_date=o)},null,512),[[g.nr,s.coupon.local_due_date]])])])]),(0,a._)("div",j,[H,o.isNew?((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"btn btn-outline-main",onClick:e[5]||(e[5]=(...o)=>l.updateCoupon&&l.updateCoupon(...o)),disabled:s.isProcessing}," 新增 ",8,K)):((0,a.wg)(),(0,a.iD)("button",{key:1,type:"button",class:"btn btn-outline-main",onClick:e[6]||(e[6]=(...o)=>l.updateCoupon&&l.updateCoupon(...o)),disabled:s.isProcessing}," 更新 ",8,Y))])])])],512)}var O=t(2863),S={name:"CouponModal",props:["init-coupon","is-new"],data(){return{modal:"",coupon:{},isProcessing:!1}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},async updateCoupon(o){try{let o="";this.coupon.due_date=new Date(this.coupon.local_due_date).getTime(),this.isProcessing=!0,o=!0===this.isNew?await b.Z.coupons.postCoupon({data:this.coupon}):await b.Z.coupons.putCoupon({id:this.coupon.id,data:this.coupon}),O.FN.fire({icon:"success",title:o.message}),this.isProcessing=!1,this.hideModal(),this.$emit("after-update")}catch(e){}}},mounted(){const o=t(7244);this.modal=new o.Modal(this.$refs.modal,{keyboard:!1,backdrop:"static"})},watch:{initCoupon(){this.coupon=this.initCoupon}}},T=t(3744);const q=(0,T.Z)(S,[["render",F]]);var B=q,G={name:"AdminCoupon",components:{Pagination:h.Z,CouponModal:B},data(){return{isLoading:!1,coupons:[],pagination:{},coupon:{},isNew:!1}},methods:{async getCoupons(o=1){try{this.isLoading=!0;const{coupons:o,pagination:e}=await b.Z.coupons.getCoupons(),t=Object.values(o);t.forEach((o=>o.local_due_date=new Date(o.due_date).toLocaleString())),this.coupons=o,this.pagination=e,this.isLoading=!1}catch(e){}},async deleteCoupon(o,e){try{const t=await O._1.fire({title:`確定刪除${o}優惠券 ？`});if(t.isConfirmed){this.isLoading=!0;const o=await b.Z.coupons.deleteCoupon(e);this.isLoading=!1,this.$swal.fire({title:`${o.message}`,icon:"success"}),this.getCoupons()}}catch(t){}},openModal(o,e){"new"===o?(this.coupon={},this.isNew=!0):"edit"===o&&(this.coupon=e,this.isNew=!1),this.$refs.couponModal.openModal()}},created(){this.getCoupons()}};const I=(0,T.Z)(G,[["render",m]]);var J=I},6718:function(o,e,t){t.d(e,{Z:function(){return h}});var a=t(6252),n=t(3577);const s={"aria-label":"Page navigation example"},l={class:"pagination"},i=(0,a._)("span",{"aria-hidden":"true"},"«",-1),d=[i],c=["onClick"],u=(0,a._)("span",{"aria-hidden":"true"},"»",-1),p=[u];function r(o,e,t,i,u,r){return(0,a.wg)(),(0,a.iD)("nav",s,[(0,a._)("ul",l,[(0,a._)("li",{class:(0,n.C_)(["page-item",{disabled:!t.pages.has_pre}])},[(0,a._)("button",{type:"button",class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=e=>o.$emit("emit-page",t.pages.current_page-1))},d)],2),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.pages.total_pages,((e,s)=>((0,a.wg)(),(0,a.iD)("li",{class:(0,n.C_)(["page-item",{active:e===t.pages.current_page}]),href:"#",key:s},[(0,a._)("button",{type:"button",class:"page-link",onClick:t=>o.$emit("emit-page",e)},(0,n.zw)(e),9,c)],2)))),128)),(0,a._)("li",{class:(0,n.C_)(["page-item",{disabled:!t.pages.has_next}])},[(0,a._)("button",{type:"button",class:"page-link","aria-label":"Next",onClick:e[1]||(e[1]=e=>o.$emit("emit-page",t.pages.current_page+1))},p)],2)])])}var _={props:["pages"]},m=t(3744);const b=(0,m.Z)(_,[["render",r]]);var h=b}}]);
//# sourceMappingURL=800.f8d66220.js.map