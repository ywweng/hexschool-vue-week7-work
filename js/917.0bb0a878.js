"use strict";(self["webpackChunkhexschool_vue_week6_work"]=self["webpackChunkhexschool_vue_week6_work"]||[]).push([[917],{7917:function(t,e,i){i.r(e),i.d(e,{default:function(){return Lt}});var o=i(6252),l=i(3577);const a={class:"list m-3 p-3"},s=(0,o._)("h5",null,"產品管理",-1),n={class:"my-3 text-end"},r={class:"table-responsive-sm"},d={class:"table table-hover"},c={width:"100"},u={class:"dropdown"},p=(0,o._)("a",{class:"dropdown-toggle",href:"#",role:"button",id:"dropdownMenuLink","data-bs-toggle":"dropdown","aria-expanded":"false"}," 分類 ",-1),m={class:"dropdown-menu","aria-labelledby":"dropdownMenuLink"},g=["onClick"],b=(0,o._)("th",{width:"150"},"產品名稱",-1),_=(0,o._)("th",{width:"100"},"原價",-1),h=(0,o._)("th",{width:"100"},"售價",-1),w=(0,o._)("th",{width:"100"},"是否啟用",-1),P=(0,o._)("th",{width:"200"},"編輯",-1),f={key:0,class:"text-success"},y={key:1},v={class:"btn-group"},k=["onClick"],U=["onClick"];function C(t,e,i,C,x,D){const M=(0,o.up)("Loading"),A=(0,o.up)("AdminProductModal"),L=(0,o.up)("Pagination");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("div",a,[s,(0,o.Wm)(M,{active:x.isLoading,loader:"dots"},null,8,["active"]),(0,o._)("div",n,[(0,o._)("button",{class:"btn-main px-3 py-2",onClick:e[0]||(e[0]=t=>D.openModal("new"))}," 建立新產品 ")]),(0,o._)("div",r,[(0,o._)("table",d,[(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",c,[(0,o._)("div",u,[p,(0,o._)("ul",m,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(x.categories,((t,e)=>((0,o.wg)(),(0,o.iD)("li",{key:e},[(0,o._)("a",{class:"dropdown-item",onClick:e=>D.getProducts(1,t)},(0,l.zw)(t),9,g)])))),128))])])]),b,_,h,w,P])]),(0,o._)("tbody",null,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(x.products,(t=>((0,o.wg)(),(0,o.iD)("tr",{class:"align-middle",key:t.id},[(0,o._)("td",null,(0,l.zw)(t.category),1),(0,o._)("td",null,(0,l.zw)(t.title),1),(0,o._)("td",null,(0,l.zw)(t.origin_price),1),(0,o._)("td",null,(0,l.zw)(t.price),1),(0,o._)("td",null,[t.is_enabled?((0,o.wg)(),(0,o.iD)("span",f,"啟用")):((0,o.wg)(),(0,o.iD)("span",y,"未啟用"))]),(0,o._)("td",null,[(0,o._)("div",v,[(0,o._)("button",{type:"button",class:"btn btn-outline-main btn-sm me-3",onClick:e=>D.openModal("edit",t)}," 編輯 ",8,k),(0,o._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>D.openModal("delete",t)}," 刪除 ",8,U)])])])))),128))])])])]),(0,o.Wm)(A,{ref:"AdminProductModal","init-product":x.tempProduct,"is-new":x.isNew,onAfterUpdate:D.getProducts},null,8,["init-product","is-new","onAfterUpdate"]),(0,o.Wm)(L,{class:"d-flex justify-content-center",pages:x.pagination,onEmitPage:D.getProducts},null,8,["pages","onEmitPage"])])}var x=i(4711),D=i(6718),M=i(9963);const A={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},L={class:"modal-dialog modal-xl"},V={class:"modal-content border-0"},N={class:"modal-header bg-dark text-white"},Z={id:"productModalLabel",class:"modal-title"},$={key:0},z={key:1},H=(0,o._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Y={class:"row mb-3"},I={class:"col-sm-4"},W={class:"form-group mb-3"},j=(0,o._)("label",{for:"imageUrl",class:"form-label"},"主要圖片",-1),E=["src"],F={key:0},O={class:"form-group"},S=(0,o._)("label",{for:"imageUrl",class:"form-label"},"圖片網址",-1),q=["onUpdate:modelValue"],B=["src"],G={key:0},J={key:1},Q={key:1},R={class:"col-sm-8"},T={class:"form-group mb-3"},X=(0,o._)("label",{for:"title",class:"form-label"},"標題",-1),tt={class:"row mb-3"},et={class:"form-group col-md-6"},it=(0,o._)("label",{for:"category",class:"form-label"},"分類",-1),ot={class:"form-group col-md-6"},lt=(0,o._)("label",{for:"price",class:"form-label"},"單位",-1),at={class:"row mb-3"},st={class:"form-group col-md-6"},nt=(0,o._)("label",{for:"origin_price",class:"form-label"},"原價",-1),rt={class:"form-group col-md-6"},dt=(0,o._)("label",{for:"price",class:"form-label"},"售價",-1),ct=(0,o._)("hr",null,null,-1),ut={class:"form-group mb-3"},pt=(0,o._)("label",{for:"description",class:"form-label"},"產品描述",-1),mt={class:"form-group mb-3"},gt=(0,o._)("label",{for:"content",class:"form-label"},"說明內容",-1),bt={class:"form-group mb-3"},_t={class:"form-check"},ht=(0,o._)("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),wt={class:"modal-footer"},Pt=(0,o._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),ft=["disabled"],yt=["disabled"];function vt(t,e,i,l,a,s){return(0,o.wg)(),(0,o.iD)("div",A,[(0,o._)("div",L,[(0,o._)("div",V,[(0,o._)("div",N,[(0,o._)("h5",Z,[t.isNew?((0,o.wg)(),(0,o.iD)("span",$,"新增產品")):((0,o.wg)(),(0,o.iD)("span",z,"編輯產品"))]),H]),(0,o._)("div",K,[(0,o._)("div",Y,[(0,o._)("div",I,[(0,o._)("div",W,[j,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e[0]||(e[0]=e=>t.initProduct.imageUrl=e),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[M.nr,t.initProduct.imageUrl]]),(0,o._)("img",{class:"img-fluid",src:t.initProduct.imageUrl},null,8,E)]),Array.isArray(t.initProduct.imagesUrl)?((0,o.wg)(),(0,o.iD)("div",F,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.initProduct.imagesUrl,((e,i)=>((0,o.wg)(),(0,o.iD)("div",{class:"mb-1",key:i},[(0,o._)("div",O,[S,(0,o.wy)((0,o._)("input",{"onUpdate:modelValue":e=>t.initProduct.imagesUrl[i]=e,type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,8,q),[[M.nr,t.initProduct.imagesUrl[i]]])]),(0,o._)("img",{class:"img-fluid",src:e},null,8,B)])))),128)),t.initProduct.imagesUrl.length<=5&&(!t.initProduct.imagesUrl.length||t.initProduct.imagesUrl[t.initProduct.imagesUrl.length-1])?((0,o.wg)(),(0,o.iD)("div",G,[(0,o._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[1]||(e[1]=e=>t.initProduct.imagesUrl.push(""))}," 新增圖片 ")])):((0,o.wg)(),(0,o.iD)("div",J,[(0,o._)("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:e[2]||(e[2]=e=>t.initProduct.imagesUrl.pop())}," 刪除圖片 ")]))])):((0,o.wg)(),(0,o.iD)("div",Q,[(0,o._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[3]||(e[3]=(...t)=>s.createImages&&s.createImages(...t))}," 新增圖片 ")]))]),(0,o._)("div",R,[(0,o._)("div",T,[X,(0,o.wy)((0,o._)("input",{id:"title","onUpdate:modelValue":e[4]||(e[4]=e=>t.initProduct.title=e),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[M.nr,t.initProduct.title]])]),(0,o._)("div",tt,[(0,o._)("div",et,[it,(0,o.wy)((0,o._)("input",{id:"category","onUpdate:modelValue":e[5]||(e[5]=e=>t.initProduct.category=e),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[M.nr,t.initProduct.category]])]),(0,o._)("div",ot,[lt,(0,o.wy)((0,o._)("input",{id:"unit","onUpdate:modelValue":e[6]||(e[6]=e=>t.initProduct.unit=e),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[M.nr,t.initProduct.unit]])])]),(0,o._)("div",at,[(0,o._)("div",st,[nt,(0,o.wy)((0,o._)("input",{id:"origin_price","onUpdate:modelValue":e[7]||(e[7]=e=>t.initProduct.origin_price=e),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[M.nr,t.initProduct.origin_price,void 0,{number:!0}]])]),(0,o._)("div",rt,[dt,(0,o.wy)((0,o._)("input",{id:"price","onUpdate:modelValue":e[8]||(e[8]=e=>t.initProduct.price=e),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[M.nr,t.initProduct.price,void 0,{number:!0}]])])]),ct,(0,o._)("div",ut,[pt,(0,o.wy)((0,o._)("textarea",{id:"description","onUpdate:modelValue":e[9]||(e[9]=e=>t.initProduct.description=e),type:"text",class:"form-control",placeholder:"請輸入產品描述"},"\n                ",512),[[M.nr,t.initProduct.description]])]),(0,o._)("div",mt,[gt,(0,o.wy)((0,o._)("textarea",{id:"description","onUpdate:modelValue":e[10]||(e[10]=e=>t.initProduct.content=e),type:"text",class:"form-control",placeholder:"請輸入說明內容"},"\n                ",512),[[M.nr,t.initProduct.content]])]),(0,o._)("div",bt,[(0,o._)("div",_t,[(0,o.wy)((0,o._)("input",{id:"is_enabled","onUpdate:modelValue":e[11]||(e[11]=e=>t.initProduct.is_enabled=e),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[M.e8,t.initProduct.is_enabled]]),ht])])])])]),(0,o._)("div",wt,[Pt,t.isNew?((0,o.wg)(),(0,o.iD)("button",{key:0,type:"button",class:"btn btn-outline-main",onClick:e[12]||(e[12]=(...t)=>s.updateProduct&&s.updateProduct(...t)),disabled:a.isProcessing}," 新增 ",8,ft)):((0,o.wg)(),(0,o.iD)("button",{key:1,type:"button",class:"btn btn-outline-main",onClick:e[13]||(e[13]=(...t)=>s.updateProduct&&s.updateProduct(...t)),disabled:a.isProcessing}," 確認更改 ",8,yt))])])])],512)}var kt=i(2863),Ut={name:"AdminProductModal",props:["init-product","is-new"],data(){return{modal:"",isProcessing:!1}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},async updateProduct(){try{let t="";this.isProcessing=!0,t=!0===this.isNew?await x.Z.products.postProduct({data:this.initProduct}):await x.Z.products.putProduct({id:this.initProduct.id,data:this.initProduct}),kt.FN.fire({icon:"success",title:t.message}),this.isProcessing=!1,this.hideModal(),this.$emit("after-update")}catch(t){}},createImages(){this.initProduct.imagesUrl=[],5!==this.initProduct.imagesUrl.length&&this.initProduct.imagesUrl.push("")}},mounted(){const t=i(7244);this.modal=new t.Modal(this.$refs.modal,{keyboard:!1,backdrop:"static"})}},Ct=i(3744);const xt=(0,Ct.Z)(Ut,[["render",vt]]);var Dt=xt,Mt={name:"AdminProductList",components:{Pagination:D.Z,AdminProductModal:Dt},data(){return{products:[],tempProduct:{},pagination:{},isNew:!1,isLoading:!1,categories:[]}},methods:{async getProducts(t=1,e=""){try{this.isLoading=!0,"全部"===e&&(e="");const{products:i,pagination:o}=await x.Z.products.getProducts(t,e);this.products=i,this.pagination=o,this.isLoading=!1}catch(i){}},async deleteProduct(t){try{this.isLoading=!0;const e=await x.Z.products.deleteProduct(t);this.isLoading=!1,this.$swal.fire({title:`${e.message}`,icon:"success"}),this.getProducts()}catch(e){}},openModal(t,e){"new"===t?(this.isNew=!0,this.tempProduct={imagesUrl:[]},this.$refs.AdminProductModal.openModal()):"edit"===t?(this.isNew=!1,this.tempProduct={...e},this.$refs.AdminProductModal.openModal()):"delete"===t&&(this.isNew=!1,kt._1.fire({title:`確定刪除 ${e.title} ？`}).then((t=>{t.isConfirmed&&this.deleteProduct(e.id)})))},async getCategory(){try{const{products:t}=await x.Z.products.getProductsAll(),e=Object.values(t).map((t=>t.category)),i=["全部",...new Set(e)];this.categories=i}catch(t){}}},created(){this.getProducts(),this.getCategory()}};const At=(0,Ct.Z)(Mt,[["render",C]]);var Lt=At},6718:function(t,e,i){i.d(e,{Z:function(){return _}});var o=i(6252),l=i(3577);const a={"aria-label":"Page navigation example"},s={class:"pagination"},n=(0,o._)("span",{"aria-hidden":"true"},"«",-1),r=[n],d=["onClick"],c=(0,o._)("span",{"aria-hidden":"true"},"»",-1),u=[c];function p(t,e,i,n,c,p){return(0,o.wg)(),(0,o.iD)("nav",a,[(0,o._)("ul",s,[(0,o._)("li",{class:(0,l.C_)(["page-item",{disabled:!i.pages.has_pre}])},[(0,o._)("button",{type:"button",class:"page-link",href:"#","aria-label":"Previous",onClick:e[0]||(e[0]=e=>t.$emit("emit-page",i.pages.current_page-1))},r)],2),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(i.pages.total_pages,((e,a)=>((0,o.wg)(),(0,o.iD)("li",{class:(0,l.C_)(["page-item",{active:e===i.pages.current_page}]),href:"#",key:a},[(0,o._)("button",{type:"button",class:"page-link",onClick:i=>t.$emit("emit-page",e)},(0,l.zw)(e),9,d)],2)))),128)),(0,o._)("li",{class:(0,l.C_)(["page-item",{disabled:!i.pages.has_next}])},[(0,o._)("button",{type:"button",class:"page-link","aria-label":"Next",onClick:e[1]||(e[1]=e=>t.$emit("emit-page",i.pages.current_page+1))},u)],2)])])}var m={props:["pages"]},g=i(3744);const b=(0,g.Z)(m,[["render",p]]);var _=b}}]);
//# sourceMappingURL=917.0bb0a878.js.map